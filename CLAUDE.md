# AI Orchestration

Multi-tenant SaaS for designing, executing, and monitoring DAG workflows with LLM and tool integrations.

---

## AI-Driven Development Project

**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯äººé–“ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä¸€åˆ‡è¡Œã‚ãšã€ã™ã¹ã¦ã‚’AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå®Ÿè£…ãƒ»ä¿å®ˆã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚**

### åŸºæœ¬åŸå‰‡

| åŸå‰‡ | èª¬æ˜ |
|------|------|
| **å®Œå…¨AIå®Ÿè£…** | è¨­è¨ˆãƒ»å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã™ã¹ã¦ã‚’AIãŒæ‹…å½“ |
| **äººé–“ã®å½¹å‰²** | è¦ä»¶å®šç¾©ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€æ‰¿èªã®ã¿ |
| **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç¶™ç¶š** | å¾Œç¶šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¦‹å¤±ã‚ãªã„ã‚ˆã†æ–‡æ›¸åŒ–å¿…é ˆ |

### AIãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦ä»¶

å¾Œç¶šã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå³åº§ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã‚’éµå®ˆï¼š

1. **æ˜ç¤ºçš„ãªè¨˜è¿°**
   - æš—é»™çŸ¥ã‚’æ’é™¤ã—ã€ã™ã¹ã¦ã‚’æ–‡æ›¸åŒ–
   - ã€Œãªãœã€ãã®è¨­è¨ˆãƒ»å®Ÿè£…ã«ã—ãŸã‹ã‚’è¨˜éŒ²
   - åˆ¶ç´„æ¡ä»¶ã‚„å‰ææ¡ä»¶ã‚’æ˜è¨˜

2. **æ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ±**
   - ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§ã®æƒ…å ±æ•´ç†ã‚’å„ªå…ˆ
   - ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã§ã®å…·ä½“ä¾‹æç¤º
   - éšå±¤çš„ãªè¦‹å‡ºã—æ§‹é€ 

3. **å‚ç…§å¯èƒ½æ€§**
   - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯çµ¶å¯¾ãƒ‘ã‚¹ã¾ãŸã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹
   - é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®ãƒªãƒ³ã‚¯ã‚’æ˜è¨˜
   - æ¤œç´¢å¯èƒ½ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚ã‚‹

4. **æœ€æ–°æ€§ã®ç¶­æŒ**
   - ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã¯å¿…ãšãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
   - å¤ã„æƒ…å ±ã¯å‰Šé™¤ã¾ãŸã¯æ›´æ–°æ—¥ã‚’æ˜è¨˜
   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨ã®æ•´åˆæ€§ã‚’ä¿ã¤

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼•ãç¶™ããƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æ–°ã—ã„AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ï¼š

```
1. [ ] CLAUDE.md ã‚’èª­ã‚€ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
2. [ ] docs/INDEX.md ã§é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç‰¹å®š
3. [ ] ä½œæ¥­å¯¾è±¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€
4. [ ] æ—¢å­˜ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºèª
5. [ ] ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼æ‰‹é †ã‚’ç¢ºèª
```

### æ„æ€æ±ºå®šã®è¨˜éŒ²

é‡è¦ãªæŠ€è¡“çš„æ±ºå®šã¯ä»¥ä¸‹ã®å½¢å¼ã§è¨˜éŒ²ï¼š

```markdown
### Decision: [æ±ºå®šäº‹é …]
- **Date**: YYYY-MM-DD
- **Context**: èƒŒæ™¯ãƒ»çŠ¶æ³
- **Options**: æ¤œè¨ã—ãŸé¸æŠè‚¢
- **Decision**: é¸æŠã—ãŸå†…å®¹
- **Rationale**: ç†ç”±
- **Consequences**: å½±éŸ¿ãƒ»çµæœ
```

---

## Quick Reference

| Item | Value |
|------|-------|
| Backend | Go 1.22+ |
| Frontend | Vue 3 + Nuxt 3 |
| Database | PostgreSQL 16 |
| Cache/Queue | Redis 7 |
| Auth | Keycloak 24 (OIDC) |
| Tracing | OpenTelemetry + Jaeger |

## Documentation Index

| Document | Purpose | Path |
|----------|---------|------|
| INDEX | Document navigation | [docs/INDEX.md](docs/INDEX.md) |
| BACKEND | Go code structure, interfaces | [docs/BACKEND.md](docs/BACKEND.md) |
| FRONTEND | Vue/Nuxt structure, composables | [docs/FRONTEND.md](docs/FRONTEND.md) |
| API | REST endpoints, schemas | [docs/API.md](docs/API.md) |
| DATABASE | Schema, queries | [docs/DATABASE.md](docs/DATABASE.md) |
| DEPLOYMENT | Docker, K8s, config | [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md) |
| DOCUMENTATION_RULES | Doc format, MECE rules | [docs/DOCUMENTATION_RULES.md](docs/DOCUMENTATION_RULES.md) |
| TESTING | Frontend testing rules | [frontend/docs/TESTING.md](frontend/docs/TESTING.md) |
| **TEST_PLAN** | **Test plan & coverage rules** | [docs/TEST_PLAN.md](docs/TEST_PLAN.md) |
| OpenAPI | Machine-readable spec | [docs/openapi.yaml](docs/openapi.yaml) |
| **UNIFIED_BLOCK_MODEL** | **Block architecture (MUST READ for integrations)** | [docs/designs/UNIFIED_BLOCK_MODEL.md](docs/designs/UNIFIED_BLOCK_MODEL.md) |
| BLOCK_REGISTRY | Block definitions, error codes | [docs/BLOCK_REGISTRY.md](docs/BLOCK_REGISTRY.md) |

**Read these docs before modifying related code.**

## Directory Structure

```
ai-orchestration/
â”œâ”€â”€ CLAUDE.md                 # This file
â”œâ”€â”€ docker-compose.yml        # Dev environment
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ cmd/api/              # API server entry
â”‚   â”œâ”€â”€ cmd/worker/           # Worker entry
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ domain/           # Entities
â”‚   â”‚   â”œâ”€â”€ usecase/          # Business logic
â”‚   â”‚   â”œâ”€â”€ handler/          # HTTP handlers
â”‚   â”‚   â”œâ”€â”€ repository/       # DB operations
â”‚   â”‚   â”œâ”€â”€ adapter/          # External integrations
â”‚   â”‚   â”œâ”€â”€ engine/           # DAG executor
â”‚   â”‚   â””â”€â”€ middleware/       # Auth
â”‚   â”œâ”€â”€ pkg/                  # Shared packages
â”‚   â”œâ”€â”€ schema/               # DB schema (schema.sql, seed.sql)
â”‚   â”œâ”€â”€ migrations/           # PostgreSQL init only
â”‚   â””â”€â”€ tests/e2e/            # Integration tests
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ pages/                # Nuxt pages
â”‚   â”œâ”€â”€ components/dag-editor/# DAG visual editor
â”‚   â”œâ”€â”€ composables/          # Vue composables
â”‚   â””â”€â”€ plugins/              # Keycloak init
â”œâ”€â”€ deploy/kubernetes/        # K8s manifests
â””â”€â”€ docs/                     # Documentation
```

## Commands

### Option A: Full Docker (ã™ã¹ã¦Dockerã§å®Ÿè¡Œ)

```bash
# Start all services
docker compose up -d

# Logs
docker compose logs -f api
docker compose logs -f worker

# Rebuild
docker compose up -d --build api worker
```

### Option B: Local Development with Hot Reload (æ¨å¥¨)

Makefileã‚’ä½¿ç”¨ã—ã¦ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰é–‹ç™ºç’°å¢ƒã‚’èµ·å‹•ï¼š

```bash
# 1. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢èµ·å‹• (PostgreSQL, Redis, Keycloak, Jaeger)
make dev-middleware

# 2. APIèµ·å‹• (ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰) - ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1
make dev-api

# 3. Workerèµ·å‹• (ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰) - ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2
make dev-worker

# 4. Frontendèµ·å‹• (ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰) - ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3
make dev-frontend

# tmuxãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã™ã¹ã¦ã‚’ä¸€åº¦ã«èµ·å‹•
make dev

# ã™ã¹ã¦åœæ­¢
make stop
```

**åˆ©ç”¨å¯èƒ½ãªMakeã‚¿ãƒ¼ã‚²ãƒƒãƒˆ:**

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `make help` | ãƒ˜ãƒ«ãƒ—è¡¨ç¤º |
| `make dev` | å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ï¼ˆtmuxä½¿ç”¨ï¼‰ |
| `make dev-middleware` | ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ã¿èµ·å‹• |
| `make dev-api` | APIã‚’ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã§èµ·å‹• |
| `make dev-worker` | Workerã‚’ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã§èµ·å‹• |
| `make dev-frontend` | Frontendã‚’ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã§èµ·å‹• |
| `make stop` | å…¨ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ |
| `make test` | å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |

**æ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰ï¼ˆå‚è€ƒï¼‰:**

```bash
# Middleware
docker compose -f docker-compose.middleware.yml up -d

# Backend API with hot reload (from project root)
cd backend && air -c .air.toml

# Worker with hot reload (from project root)
cd backend && air -c .air.worker.toml

# Frontend (from frontend/ directory)
npm run dev
```

### Option C: Hybrid Development (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ã‚«ãƒ« + APIã¯Docker)

ãƒ­ãƒ¼ã‚«ãƒ«Goã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´ãŒã‚ã‚‹å ´åˆã€ã“ã®æ–¹æ³•ã‚’ä½¿ç”¨ï¼š

```bash
# 1. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨API/Workerã‚’ Docker ã§èµ·å‹•
docker compose up -d postgres redis keycloak jaeger api worker

# 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•
cd frontend && npm run dev
```

**ã‚¢ã‚¯ã‚»ã‚¹URL:**
- Frontend: http://localhost:3000
- API: http://localhost:8080
- Keycloak: http://localhost:8180
- Jaeger: http://localhost:16686

**æ³¨æ„:** ãƒ­ãƒ¼ã‚«ãƒ«Goã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆï¼ˆ`compile: version "go1.x.x" does not match go tool version "go1.y.y"`ï¼‰ã€APIã¯Dockerã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### Tests

```bash
# Backend Test (local)
cd backend && go test ./...
cd backend && go test ./tests/e2e/... -v

# Backend Test (Docker)
docker compose exec api go test ./...

# Frontend Test
cd frontend && npm run check       # All checks (typecheck + lint + test)
cd frontend && npm run typecheck   # TypeScript only
cd frontend && npm run test:run    # Unit tests only
```

## URLs (Development)

| Service | URL |
|---------|-----|
| API | http://localhost:8080 |
| Frontend | http://localhost:3000 |
| Keycloak | http://localhost:8180 |
| Jaeger | http://localhost:16686 |

## Test Credentials

| User | Password | Role |
|------|----------|------|
| admin@example.com | admin123 | tenant_admin |
| builder@example.com | builder123 | builder |

Default tenant ID: `00000000-0000-0000-0000-000000000001`

## Core Concepts

### Step Types

| Type | Purpose | Config |
|------|---------|--------|
| `start` | Entry point | - |
| `llm` | LLM call | `provider`, `model`, `prompt` |
| `tool` | Adapter exec | `adapter_id` |
| `condition` | Branch (2-way) | `expression` |
| `switch` | Multi-branch routing | `cases`, `default` |
| `map` | Array parallel | `input_path`, `parallel` |
| `join` | Merge | - |
| `subflow` | Nested workflow | `workflow_id` |
| `loop` | Iteration | `loop_type`, `count`, `condition` |
| `wait` | Delay/Timer | `duration_ms`, `until` |
| `function` | Custom code | `code`, `language` |
| `router` | AI routing | `routes`, `provider`, `model` |
| `human_in_loop` | Approval gate | `instructions`, `timeout_hours` |
| `filter` | Filter items | `expression` |
| `split` | Split into batches | `batch_size` |
| `aggregate` | Aggregate data | `mode` |
| `error` | Stop with error | `message` |
| `note` | Documentation | `content` |
| `log` | Debug logging | `message`, `level` |

### Adapters

| ID | File | Purpose |
|----|------|---------|
| `mock` | adapter/mock.go | Testing |
| `openai` | adapter/openai.go | GPT API |
| `anthropic` | adapter/anthropic.go | Claude API |
| `http` | adapter/http.go | Generic HTTP |

### Run States

```
pending -> running -> completed | failed | cancelled
```

### Condition Expression Syntax

```
$.field == "value"     # equality
$.field != "value"     # inequality
$.field > 10           # numeric
$.nested.field         # nested path
$.field                # truthy
```

## Development Rules

### Workflow (REQUIRED)

1. Read relevant docs before code changes
2. Update docs when changing specs
3. Use TodoWrite for task tracking
4. Run tests after changes
5. **Restart services after code changes** (see below)

### Service Restart After Code Changes (REQUIRED)

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰å¤‰æ›´å¾Œã¯ã€å¿…ãšé–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã™ã‚‹ã“ã¨ã€‚**

| å¤‰æ›´å¯¾è±¡ | å†èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ |
|----------|---------------|
| `backend/cmd/api/` | `docker compose restart api` |
| `backend/cmd/worker/` | `docker compose restart worker` |
| `backend/internal/` | `docker compose restart api worker` |
| ä¸¡æ–¹ | `docker compose restart api worker` |

```bash
# Dockerç’°å¢ƒã®å ´åˆ
docker compose restart api worker

# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆairä½¿ç”¨ï¼‰ã®å ´åˆã¯è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹
```

**é‡è¦:**
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã ã‘ã§ã¯åæ˜ ã•ã‚Œãªã„ï¼ˆç‰¹ã«Dockerç’°å¢ƒï¼‰
- å¤‰æ›´ã‚’æ¤œè¨¼ã™ã‚‹å‰ã«å¿…ãšå†èµ·å‹•ã‚’å®Ÿè¡Œ
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã§è‡ªå‹•åæ˜ ã•ã‚Œã‚‹ãŸã‚å†èµ·å‹•ä¸è¦

### Self-Documentation (REQUIRED)

**AI agents MUST maintain documentation autonomously.**

#### Before Any Code Change

```
1. Read docs/INDEX.md to find relevant document
2. Read the relevant document
3. Verify understanding matches implementation
```

#### When Documentation Missing

| Situation | Action |
|-----------|--------|
| No doc for area being modified | Create new doc following DOCUMENTATION_RULES.md |
| Existing doc incomplete | Update existing doc |
| Code contradicts doc | Fix code OR update doc (confirm intent first) |

#### After Code Change

```
1. Update relevant doc in docs/
2. If new feature/module: create docs/{FEATURE}.md
3. If new doc created: update docs/INDEX.md
4. Follow MECE principle (see docs/DOCUMENTATION_RULES.md)
```

#### Documentation Priority

1. **MUST document**: Public interfaces, API changes, config changes
2. **SHOULD document**: Internal architecture decisions, non-obvious patterns
3. **MAY skip**: Trivial implementation details (use code comments)

### Documentation Sync Flow (REQUIRED)

**ã‚³ãƒ¼ãƒ‰ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é½Ÿé½¬ã‚’é˜²ããŸã‚ã®å¿…é ˆãƒ•ãƒ­ãƒ¼**

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´æ™‚ã®æ›´æ–°å¯¾è±¡ãƒãƒƒãƒ”ãƒ³ã‚°

| å¤‰æ›´å†…å®¹ | æ›´æ–°å¿…é ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|---------|-------------------|
| æ–°è¦ãƒ–ãƒ­ãƒƒã‚¯/å¤–éƒ¨é€£æºè¿½åŠ  | `BLOCK_REGISTRY.md`, `UNIFIED_BLOCK_MODEL.md`ï¼ˆå‚ç…§ã®ã¿ï¼‰ |
| DBã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ | `DATABASE.md` |
| APIè¿½åŠ /å¤‰æ›´ | `API.md`, `openapi.yaml` |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹é€ å¤‰æ›´ | `BACKEND.md` |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹é€ å¤‰æ›´ | `FRONTEND.md` |
| èªè¨¼/èªå¯å¤‰æ›´ | `DEPLOYMENT.md` |

#### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã‚³ãƒ¼ãƒ‰å¤‰æ›´å®Œäº†å¾Œã€ä»¥ä¸‹ã‚’ç¢ºèªï¼š

```
1. [ ] å¤‰æ›´ã—ãŸæ©Ÿèƒ½ã«é–¢é€£ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç‰¹å®š
2. [ ] è©²å½“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨˜è¼‰ãŒå®Ÿè£…ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª
3. [ ] å¤ã„æƒ…å ±ãŒã‚ã‚Œã°æ›´æ–°ï¼ˆã€Œå®Ÿè£…æ¸ˆã¿ã€ç­‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°å«ã‚€ï¼‰
4. [ ] ç›¸äº’å‚ç…§ãƒªãƒ³ã‚¯ãŒæ­£ã—ã„ã‹ç¢ºèª
5. [ ] docs/INDEX.md ã«æ–°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å‚ç…§ãŒã‚ã‚‹ã‹ç¢ºèª
```

#### é½Ÿé½¬é˜²æ­¢ã®ãŸã‚ã®è¨­è¨ˆåŸå‰‡

| åŸå‰‡ | èª¬æ˜ |
|------|------|
| **Single Source of Truth** | åŒã˜æƒ…å ±ã‚’è¤‡æ•°ç®‡æ‰€ã«æ›¸ã‹ãªã„ã€‚å‚ç…§ãƒªãƒ³ã‚¯ã‚’ä½¿ã† |
| **Statusæ˜è¨˜** | è¨­è¨ˆæ›¸ã«ã¯ `Status: âœ… å®Ÿè£…æ¸ˆã¿ / ğŸ“‹ æœªå®Ÿè£…` ã‚’æ˜è¨˜ |
| **Updatedæ—¥ä»˜** | é‡è¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯æ›´æ–°æ—¥ã‚’è¨˜è¼‰ |
| **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒªãƒ³ã‚¯** | Related Documents ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç›¸äº’ãƒªãƒ³ã‚¯ |

#### é½Ÿé½¬ç™ºè¦‹æ™‚ã®å¯¾å¿œãƒ•ãƒ­ãƒ¼

```
1. é½Ÿé½¬ã‚’ç™ºè¦‹
   â†“
2. ã©ã¡ã‚‰ãŒæ­£ã—ã„ã‹ç¢ºèªï¼ˆå®Ÿè£… vs ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
   â†“
3. å®Ÿè£…ãŒæ­£ã—ã„å ´åˆ â†’ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°
   ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ­£ã—ã„å ´åˆ â†’ å®Ÿè£…ã‚’ä¿®æ­£ï¼ˆã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªï¼‰
   â†“
4. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚åŒæ™‚ã«ç¢ºèªãƒ»æ›´æ–°
   â†“
5. é½Ÿé½¬ã®åŸå› ã‚’åˆ†æã—ã€å†ç™ºé˜²æ­¢ç­–ã‚’CLAUDE.mdã«è¿½è¨˜
```

#### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚

```
CLAUDE.md (ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ)
  â”œâ”€â”€ docs/INDEX.md (ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³)
  â”‚     â”œâ”€â”€ BACKEND.md
  â”‚     â”œâ”€â”€ FRONTEND.md
  â”‚     â”œâ”€â”€ API.md
  â”‚     â”œâ”€â”€ DATABASE.md
  â”‚     â””â”€â”€ designs/UNIFIED_BLOCK_MODEL.md â† BLOCK_REGISTRY.md
  â”‚
  â””â”€â”€ å¤‰æ›´æ™‚ã¯ä¸Šè¨˜ã®ä¾å­˜é–¢ä¿‚ã‚’è€ƒæ…®ã—ã¦æ›´æ–°
```

**é‡è¦**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«é–¢ã‚ã‚‹å¤‰æ›´ï¼ˆUnified Block Modelç­‰ï¼‰ã¯ã€è¤‡æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å½±éŸ¿ã™ã‚‹ã€‚
å¤‰æ›´å‰ã«å½±éŸ¿ç¯„å›²ã‚’ç¢ºèªã—ã€ã™ã¹ã¦ã®é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã€‚

### Frontend Testing Workflow (REQUIRED)

**AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ã‚’å¿…ãšå®Ÿè¡Œã™ã‚‹ã“ã¨ï¼š**

```bash
# Frontend directory
cd frontend

# 1. TypeScript check (MUST pass)
npm run typecheck

# 2. Lint check
npm run lint

# 3. Run tests
npm run test:run

# 4. Or run all checks at once
npm run check
```

| Check | Command | Required |
|-------|---------|----------|
| TypeScript | `npm run typecheck` | **å¿…é ˆ** |
| ESLint | `npm run lint` | æ¨å¥¨ |
| Unit Tests | `npm run test:run` | æ¨å¥¨ |
| All Checks | `npm run check` | **å®Œäº†å‰å¿…é ˆ** |
| Docker Build | `docker compose build frontend` | **package.jsonå¤‰æ›´æ™‚å¿…é ˆ** |

**ç¦æ­¢äº‹é …ï¼š**
- TypeScriptã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Œäº†ã¨ã™ã‚‹ã“ã¨
- ãƒ–ãƒ©ã‚¦ã‚¶ç¢ºèªãªã—ã§UIå¤‰æ›´ã‚’å®Œäº†ã¨ã™ã‚‹ã“ã¨
- å‹ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ã‚¹ãƒˆã§å›é¿ã™ã‚‹ã“ã¨ï¼ˆæ ¹æœ¬åŸå› ã‚’ä¿®æ­£ï¼‰
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆ`@rollup/rollup-darwin-*`ç­‰ï¼‰ã‚’dependenciesã«è¿½åŠ 

**è©³ç´°ã¯ [frontend/docs/TESTING.md](frontend/docs/TESTING.md) ã‚’å‚ç…§**

### Test Coverage Maintenance (REQUIRED)

**ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¶­æŒãƒ»å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®ãƒ«ãƒ¼ãƒ«**

è©³ç´°ã¯ [docs/TEST_PLAN.md](docs/TEST_PLAN.md) ã‚’å‚ç…§ã€‚

#### æ–°è¦ã‚³ãƒ¼ãƒ‰ = æ–°è¦ãƒ†ã‚¹ãƒˆ (Mandatory)

| è¿½åŠ ã™ã‚‹ã‚³ãƒ¼ãƒ‰ | å¿…è¦ãªãƒ†ã‚¹ãƒˆ |
|--------------|-------------|
| æ–°è¦Handler | Handler unit tests + request validation |
| æ–°è¦Usecase | Usecase unit tests + edge cases |
| æ–°è¦Repository | Repository tests (DB mock or test container) |
| æ–°è¦Adapter | Adapter tests with mock external service |
| æ–°è¦Composable | Composable unit tests |
| æ–°è¦Component | Component tests (mount, props, events) |

#### ãƒã‚°ä¿®æ­£ = å›å¸°ãƒ†ã‚¹ãƒˆ (Mandatory)

```
1. ãƒã‚°ã‚’å†ç¾ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
2. ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£
3. ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
4. é–¢é€£ã™ã‚‹ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã‚‚è¿½åŠ 
```

#### ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤

| Area | Minimum | Target |
|------|---------|--------|
| Backend Unit | 50% | 70% |
| Frontend Unit | 40% | 60% |
| E2E Critical Paths | 60% | 80% |

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸Šè¨˜Targetã‚’æº€ãŸã™ã“ã¨ã€‚**

#### ãƒ†ã‚¹ãƒˆãªã—ã§ãƒãƒ¼ã‚¸ç¦æ­¢

ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã§ã¯ãƒ†ã‚¹ãƒˆãªã—ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒ¼ã‚¸ã—ãªã„ï¼š

- æ–°è¦Handler/Usecase/Repository
- ãƒã‚°ä¿®æ­£
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®å¤‰æ›´
- å¤–éƒ¨APIé€£æº

#### ãƒ†ã‚¹ãƒˆå“è³ªåŸºæº–

| åŸºæº– | èª¬æ˜ |
|------|------|
| ç‹¬ç«‹æ€§ | ä»–ã®ãƒ†ã‚¹ãƒˆã«ä¾å­˜ã—ãªã„ |
| å†ç¾æ€§ | ä½•åº¦å®Ÿè¡Œã—ã¦ã‚‚åŒã˜çµæœ |
| é«˜é€Ÿ | å˜ä½“ãƒ†ã‚¹ãƒˆã¯100msä»¥å†… |
| æ˜ç¢ºæ€§ | ãƒ†ã‚¹ãƒˆåã‹ã‚‰ç›®çš„ãŒã‚ã‹ã‚‹ |

#### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã‚³ãƒ¼ãƒ‰å¤‰æ›´å®Œäº†å‰ã«ç¢ºèªï¼š

```bash
# Backend
cd backend && go test ./...

# Frontend
cd frontend && npm run check

# E2E (é‡è¦ãªå¤‰æ›´æ™‚)
cd backend && go test ./tests/e2e/... -v
```

### DAG Editor Modification (REQUIRED)

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆDAGã‚¨ãƒ‡ã‚£ã‚¿ï¼‰ã‚’ä¿®æ­£ã™ã‚‹å ´åˆã€å¿…ãšä»¥ä¸‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ï¼š**

```
1. [ ] docs/FRONTEND.md ã®ã€ŒBlock Group Push Logicã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’èª­ã‚€
2. [ ] docs/FRONTEND.md ã®ã€ŒGroup Resize Logicã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’èª­ã‚€
3. [ ] Vue Flowã®è¦ªå­ãƒãƒ¼ãƒ‰é–¢ä¿‚ï¼ˆç›¸å¯¾åº§æ¨™ vs çµ¶å¯¾åº§æ¨™ï¼‰ã‚’ç†è§£ã™ã‚‹
4. [ ] è¡çªåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®3ã‚±ãƒ¼ã‚¹åˆ†é¡ã‚’ç†è§£ã™ã‚‹
```

**é‡è¦ãªæ³¨æ„ç‚¹ï¼š**

| é ˜åŸŸ | æ³¨æ„ç‚¹ |
|------|--------|
| åº§æ¨™ç³» | å­ãƒãƒ¼ãƒ‰ã¯è¦ªã‹ã‚‰ã®ç›¸å¯¾åº§æ¨™ã€‚æŠ¼å‡ºå¾Œã¯çµ¶å¯¾åº§æ¨™ã«å¤‰æ›å¿…é ˆ |
| ãƒªã‚µã‚¤ã‚º | `onGroupResize`ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä½ç½®è£œæ­£å¿…é ˆï¼ˆè¦–è¦šçš„ã‚¸ãƒ£ãƒ³ãƒ—é˜²æ­¢ï¼‰ |
| è¡çªåˆ¤å®š | `fullyInside`, `fullyOutside`, `onBoundary`ã®3ã‚±ãƒ¼ã‚¹ã§å‡¦ç† |
| ã‚¤ãƒ™ãƒ³ãƒˆé †åº | `group:update` â†’ `group:resize-complete`ã®é †ã§ç™ºç«å¿…é ˆ |
| ãƒã‚¹ãƒˆ | ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒã‚¹ãƒˆã¯éå¯¾å¿œï¼ˆå¤–å´ã«ã‚¹ãƒŠãƒƒãƒ—ï¼‰ |

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ï¼š**
- `components/dag-editor/DagEditor.vue` - è¡çªåˆ¤å®šã€ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ©
- `pages/workflows/[id].vue` - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã€APIæ°¸ç¶šåŒ–

### Bug Fix Flow

1. Write failing test reproducing bug
2. Verify test fails
3. Fix code
4. Verify test passes

### Task Type Decision (åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ã‚¬ã‚¤ãƒ‰)

ä½œæ¥­é–‹å§‹å‰ã«ã‚¿ã‚¹ã‚¯ã®ç¨®é¡ã¨å½±éŸ¿ç¯„å›²ã‚’åˆ¤åˆ¥ã™ã‚‹ã€‚

**ã‚¿ã‚¹ã‚¯ç¨®é¡ã®åˆ¤åˆ¥:**

| ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ | å¯¾å¿œæ–¹é‡ |
|--------------|---------|
| ãƒã‚°ä¿®æ­£ | å†ç¾ãƒ†ã‚¹ãƒˆä½œæˆ â†’ ä¿®æ­£ â†’ ãƒ†ã‚¹ãƒˆç¢ºèª |
| æ–°æ©Ÿèƒ½è¿½åŠ  | æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèª â†’ å®Ÿè£… â†’ ãƒ†ã‚¹ãƒˆ â†’ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
| ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° | æ—¢å­˜ãƒ†ã‚¹ãƒˆç¢ºèª â†’ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ â†’ æŒ¯ã‚‹èˆã„ä¸å¤‰ã‚’ç¢ºèª |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–° | é–¢é€£ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª â†’ æ›´æ–° |
| èª¿æŸ»ãƒ»è³ªå• | ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§å›ç­”ï¼ˆå¤‰æ›´ä¸è¦ï¼‰ |

**å½±éŸ¿ç¯„å›²ã®åˆ¤åˆ¥:**

| å¤‰æ›´å¯¾è±¡ | å¯¾å¿œæ–¹é‡ |
|---------|---------|
| å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ | ç›´æ¥ä¿®æ­£ |
| è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåŒä¸€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã§å®Œçµã•ã›ã‚‹ |
| è¤‡æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | å½±éŸ¿ç¯„å›²ã‚’å…¨ã¦ç¢ºèªã—ã¦ã‹ã‚‰ç€æ‰‹ |
| ä¸æ˜ | å½±éŸ¿ç¯„å›²ã‚’èª¿æŸ»ã—ã¦ã‹ã‚‰ç€æ‰‹ |

### Commit Message Convention (è©³ç´°)

**å½¢å¼:**
```
<type>: <summary>

<bodyï¼ˆä»»æ„ï¼‰>
```

**typeã®ç¨®é¡:**

| type | ç”¨é€” |
|------|------|
| `feat` | æ–°æ©Ÿèƒ½ |
| `fix` | ãƒã‚°ä¿®æ­£ |
| `refactor` | ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ©Ÿèƒ½å¤‰æ›´ãªã—ï¼‰ |
| `docs` | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ã®å¤‰æ›´ |
| `test` | ãƒ†ã‚¹ãƒˆã®è¿½åŠ ãƒ»ä¿®æ­£ |
| `chore` | ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã€è£œåŠ©ãƒ„ãƒ¼ãƒ«ã®å¤‰æ›´ |

**summaryã®æ›¸ãæ–¹:**
- æ—¥æœ¬èªã§è¨˜è¿°
- 50æ–‡å­—ä»¥å†…ã‚’ç›®å®‰
- å‹•è©ã§å§‹ã‚ã‚‹ï¼ˆã€Œè¿½åŠ ã€ã€Œä¿®æ­£ã€ã€Œå¤‰æ›´ã€ãªã©ï¼‰
- å¥ç‚¹ï¼ˆã€‚ï¼‰ã¯ä»˜ã‘ãªã„

**ã‚³ãƒŸãƒƒãƒˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°:**

| ä½œæ¥­çŠ¶æ…‹ | åˆ¤æ–­ |
|---------|------|
| æ©Ÿèƒ½ãŒå®Œæˆã—ãŸ | ã‚³ãƒŸãƒƒãƒˆ |
| ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã—ãŸ | ã‚³ãƒŸãƒƒãƒˆ |
| ä½œæ¥­é€”ä¸­ã ãŒåŒºåˆ‡ã‚ŠãŒã‚ˆã„ | ã‚³ãƒŸãƒƒãƒˆ |
| ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‰ãªã„ | **ã‚³ãƒŸãƒƒãƒˆã—ãªã„** |
| ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã„ã‚‹ | **ã‚³ãƒŸãƒƒãƒˆã—ãªã„** |

**ã‚³ãƒŸãƒƒãƒˆç²’åº¦:**

| å¤‰æ›´å†…å®¹ | ç²’åº¦ |
|---------|------|
| å˜ä¸€ã®ç›®çš„ï¼ˆãƒã‚°ä¿®æ­£ã€æ©Ÿèƒ½è¿½åŠ ãªã©ï¼‰ | 1ã‚³ãƒŸãƒƒãƒˆ |
| è¤‡æ•°ã®ç‹¬ç«‹ã—ãŸå¤‰æ›´ | å¤‰æ›´ã”ã¨ã«åˆ†å‰² |
| ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° + æ©Ÿèƒ½è¿½åŠ  | åˆ¥ã‚³ãƒŸãƒƒãƒˆã«åˆ†å‰² |

### Error Handling Decision (ã‚¨ãƒ©ãƒ¼å¯¾å‡¦ãƒ•ãƒ­ãƒ¼)

**ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼:**

| ã‚¨ãƒ©ãƒ¼ç¨®é¡ | å¯¾å‡¦æ³• |
|-----------|--------|
| importã‚¨ãƒ©ãƒ¼ | `go mod tidy` ã‚’å®Ÿè¡Œ |
| å‹ã‚¨ãƒ©ãƒ¼ | å‹å®šç¾©ã‚’ç¢ºèªã€å¿…è¦ã«å¿œã˜ã¦ä¿®æ­£ |
| undefinedã‚¨ãƒ©ãƒ¼ | é–¢æ•°ãƒ»å¤‰æ•°ã®å®šç¾©æ¼ã‚Œã‚’ç¢ºèª |
| å¾ªç’°å‚ç…§ã‚¨ãƒ©ãƒ¼ | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆã‚’è¦‹ç›´ã— |

**ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:**

| ã‚¨ãƒ©ãƒ¼ç¨®é¡ | å¯¾å‡¦æ³• |
|-----------|--------|
| ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—ï¼ˆæœŸå¾…å€¤ãŒé–“é•ã„ï¼‰ | ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£ |
| ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—ï¼ˆå®Ÿè£…ãŒé–“é•ã„ï¼‰ | å®Ÿè£…ã‚’ä¿®æ­£ |
| ãƒ‘ãƒ‹ãƒƒã‚¯ç™ºç”Ÿ | nil ãƒã‚§ãƒƒã‚¯ã€å¢ƒç•Œå€¤ã‚’ç¢ºèª |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | ç„¡é™ãƒ«ãƒ¼ãƒ—ã€ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã‚’ç¢ºèª |

**è§£æ±ºã§ããªã„å ´åˆ:**
1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ­£ç¢ºã«è¨˜éŒ²
2. å†ç¾æ‰‹é †ã‚’æ•´ç†
3. é–¢é€£ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç‰¹å®š
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Šã—ã€è¿½åŠ æƒ…å ±ã‚’æ±‚ã‚ã‚‹

### User Confirmation Required (ç¢ºèªãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹)

ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã—ã¦ã‹ã‚‰é€²ã‚ã‚‹:

| ã‚±ãƒ¼ã‚¹ | ç¢ºèªå†…å®¹ |
|--------|---------|
| ç ´å£Šçš„å¤‰æ›´ | æ—¢å­˜ã®æŒ¯ã‚‹èˆã„ã‚’å¤‰æ›´ã—ã¦ã‚ˆã„ã‹ |
| å¤§è¦æ¨¡ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° | æ–¹é‡ã‚’ç¢ºèª |
| å¤–éƒ¨APIä»•æ§˜ã®ä¸æ˜ç‚¹ | ä»•æ§˜ã®è©³ç´° |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã‚ã‚‹å¤‰æ›´ | èªè¨¼ãƒ»èªå¯ã®è¦ä»¶ |
| è¤‡æ•°ã®å®Ÿè£…æ–¹æ³•ãŒã‚ã‚‹ | ã©ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å–ã‚‹ã‹ |

### Self-Verification Checklist (è‡ªå·±æ¤œè¨¼)

ä½œæ¥­å®Œäº†æ™‚ã«ç¢ºèª:

**Backend:**
- [ ] `go build ./...` ãŒãƒ‘ã‚¹
- [ ] `go test ./...` ãŒãƒ‘ã‚¹
- [ ] ä¸è¦ãªãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
- [ ] ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¦å‹•ä½œç¢ºèª

**Frontend:**
- [ ] `npm run typecheck` ãŒãƒ‘ã‚¹
- [ ] `npm run lint` ãŒãƒ‘ã‚¹
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œç¢ºèª

**å…±é€š:**
- [ ] ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã«é•åã—ã¦ã„ãªã„ã‹
- [ ] ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ãƒ»æ›´æ–°ã—ãŸã‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ãŸã‹ï¼ˆå¿…è¦ãªå ´åˆï¼‰
- [ ] ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦ç´„ã«å¾“ã£ã¦ã„ã‚‹

### Code Conventions

**Go:**
- gofmt/goimports
- Explicit error handling (no `_` ignore)
- log/slog for logging
- testify for tests

**Vue/TS:**
- Composition API
- `<script setup lang="ts">`
- PascalCase components
- `use` prefix for composables
- **ãƒ–ãƒ©ã‚¦ã‚¶ã®alert/confirm/promptã¯ä½¿ç”¨ç¦æ­¢** - AIãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ãŸã‚ã€`useToast()`ã‚’ä½¿ç”¨

### Git

- Branches: `feature/`, `fix/`, `docs/`
- Commits: Conventional Commits (`feat:`, `fix:`, `docs:`, `refactor:`, `test:`, `chore:`)

**ç¦æ­¢äº‹é …:**

| æ“ä½œ | ç†ç”± |
|------|------|
| `git push --force` to main/master | å±¥æ­´ç ´å£Š |
| `git reset --hard` on shared branch | ä»–è€…ã®ä½œæ¥­ã‚’æ¶ˆã™ |
| ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ã‚³ãƒŸãƒƒãƒˆ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ |
| å·¨å¤§ãªãƒã‚¤ãƒŠãƒªã®ã‚³ãƒŸãƒƒãƒˆ | ãƒªãƒã‚¸ãƒˆãƒªè‚¥å¤§åŒ– |

**æ³¨æ„ãŒå¿…è¦ãªæ“ä½œ:**

| æ“ä½œ | æ³¨æ„ç‚¹ |
|------|--------|
| `git commit --amend` | pushæ¸ˆã¿ã®å ´åˆã¯ç¦æ­¢ |
| `git rebase` | å…±æœ‰ãƒ–ãƒ©ãƒ³ãƒã§ã¯ç¦æ­¢ |
| `.gitignore` ã®å¤‰æ›´ | å½±éŸ¿ç¯„å›²ã‚’ç¢ºèª |

### Multi-tenancy

All queries MUST include `tenant_id` filter.

### API Design

- Base: `/api/v1`
- Auth: Bearer JWT
- Dev mode: `X-Tenant-ID` header
- Error: `{"error": {"code": "...", "message": "..."}}`

### Session Management (AI Agent)

**ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®å¼•ãç¶™ãï¼š**

```
1. æœªå®Œäº†ã‚¿ã‚¹ã‚¯ã‚’TodoWriteã§è¨˜éŒ²
2. å®Ÿè£…ã—ãŸå†…å®¹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
3. æ—¢çŸ¥ã®å•é¡Œãƒ»èª²é¡Œã‚’æ˜è¨˜
4. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜ç¢ºã«è¨˜è¼‰
```

**ç¦æ­¢äº‹é …ï¼š**
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ãªã—ã§ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
- æš—é»™çš„ãªå‰æã«ä¾å­˜ã—ãŸå®Ÿè£…
- å£é ­èª¬æ˜ã§ã—ã‹ä¼ã‚ã‚‰ãªã„è¨­è¨ˆæ±ºå®š

## Environment Variables

| Variable | Service | Description |
|----------|---------|-------------|
| `DATABASE_URL` | api, worker | PostgreSQL |
| `REDIS_URL` | api, worker | Redis |
| `AUTH_ENABLED` | api | Enable JWT (default: false) |
| `TELEMETRY_ENABLED` | api, worker | Enable tracing |
| `OPENAI_API_KEY` | worker | OpenAI key |
| `ANTHROPIC_API_KEY` | worker | Anthropic key |

## API Quick Test

```bash
# Create workflow
curl -X POST http://localhost:8080/api/v1/workflows \
  -H "Content-Type: application/json" \
  -H "X-Tenant-ID: 00000000-0000-0000-0000-000000000001" \
  -d '{"name": "Test"}'

# Add step
curl -X POST "http://localhost:8080/api/v1/workflows/{id}/steps" \
  -H "Content-Type: application/json" \
  -H "X-Tenant-ID: 00000000-0000-0000-0000-000000000001" \
  -d '{"name": "Step1", "type": "tool", "config": {"adapter_id": "mock"}}'

# Publish
curl -X POST "http://localhost:8080/api/v1/workflows/{id}/publish" \
  -H "X-Tenant-ID: 00000000-0000-0000-0000-000000000001"

# Execute
curl -X POST "http://localhost:8080/api/v1/workflows/{id}/runs" \
  -H "Content-Type: application/json" \
  -H "X-Tenant-ID: 00000000-0000-0000-0000-000000000001" \
  -d '{"input": {}, "mode": "test"}'
```

## Common Operations

### Add New Block / Integration (REQUIRED READING)

**âš ï¸ å¤–éƒ¨é€£æºï¼ˆDiscord, Slack, Notionç­‰ï¼‰ã‚’è¿½åŠ ã™ã‚‹å ´åˆã€å¿…ãšä»¥ä¸‹ã‚’å…ˆã«èª­ã‚€ã“ã¨ï¼š**

```
1. [ ] docs/designs/UNIFIED_BLOCK_MODEL.md ã‚’èª­ã‚€
2. [ ] æ—¢å­˜ãƒ–ãƒ­ãƒƒã‚¯ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºèªï¼ˆmigrations/011_unified_block_model.sqlï¼‰
3. [ ] ctx ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆhttp, llm, workflow, human, adapterï¼‰ã‚’ç†è§£ã™ã‚‹
```

**ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆUnified Block Modelï¼‰:**

| æ–¹å¼ | èª¬æ˜ | ç”¨é€” |
|------|------|------|
| **Migrationè¿½åŠ ** | JavaScriptã‚³ãƒ¼ãƒ‰ã‚’DBã«ç™»éŒ² | **æ–°è¦ãƒ–ãƒ­ãƒƒã‚¯è¿½åŠ ã®æ¨™æº–æ–¹å¼** |
| Go Adapterè¿½åŠ  | Goã§ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å®Ÿè£… | LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ç­‰ã®ç‰¹æ®Šã‚±ãƒ¼ã‚¹ã®ã¿ |

**æ–°è¦ãƒ–ãƒ­ãƒƒã‚¯è¿½åŠ æ‰‹é †ï¼ˆæ¨™æº–ï¼‰:**

1. Migrationãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ: `backend/migrations/XXX_{name}_block.sql`
2. `block_definitions`ãƒ†ãƒ¼ãƒ–ãƒ«ã«INSERT
   - `tenant_id = NULL` ã§ã‚·ã‚¹ãƒ†ãƒ ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æä¾›ï¼‰
   - `code`ã«JavaScriptã‚³ãƒ¼ãƒ‰ï¼ˆ`ctx.http`ç­‰ã‚’ä½¿ç”¨ï¼‰
   - `ui_config`ã«ã‚¢ã‚¤ã‚³ãƒ³ãƒ»ã‚«ãƒ©ãƒ¼ãƒ»è¨­å®šã‚¹ã‚­ãƒ¼ãƒ
3. Migrationå®Ÿè¡Œ
4. docs/BLOCK_REGISTRY.md ã‚’æ›´æ–°

**ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆDiscordé€šçŸ¥ãƒ–ãƒ­ãƒƒã‚¯ï¼‰:**

```sql
INSERT INTO block_definitions (tenant_id, slug, name, category, code, ui_config, is_system)
VALUES (
  NULL,  -- ã‚·ã‚¹ãƒ†ãƒ ãƒ–ãƒ­ãƒƒã‚¯
  'discord',
  'Discordé€šçŸ¥',
  'integration',
  $code$
    const webhookUrl = config.webhook_url || ctx.secrets.DISCORD_WEBHOOK_URL;
    const payload = { content: renderTemplate(config.message, input) };
    return await ctx.http.post(webhookUrl, payload);
  $code$,
  '{"icon": "message-circle", "color": "#5865F2", "configSchema": {...}}',
  TRUE
);
```

**Go AdapterãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹ï¼ˆä¾‹å¤–ï¼‰:**

| ã‚±ãƒ¼ã‚¹ | ç†ç”± |
|--------|------|
| LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¿½åŠ  | `ctx.llm`çµŒç”±ã§å‘¼ã³å‡ºã™ãŸã‚ |
| è¤‡é›‘ãªèªè¨¼ãƒ•ãƒ­ãƒ¼ | OAuth2ç­‰ã€JSã§ã¯å›°é›£ãªå ´åˆ |
| ãƒã‚¤ãƒŠãƒªå‡¦ç† | ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ç­‰ |

Go Adapterè¿½åŠ ãŒå¿…è¦ãªå ´åˆã®ã¿:
1. Create `backend/internal/adapter/{name}.go`
2. Implement `Adapter` interface
3. Register in registry
4. Add test `{name}_test.go`
5. Update docs/BACKEND.md

### Add New API Endpoint

1. Add handler in `backend/internal/handler/`
2. Add route in `cmd/api/main.go`
3. Add usecase if needed
4. Update docs/API.md and docs/openapi.yaml

### Database Schema Management

ã‚¹ã‚­ãƒ¼ãƒã¯ `backend/schema/` ã§å®£è¨€çš„ã«ç®¡ç†:

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|---------|------|
| `schema.sql` | ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ï¼ˆSingle Source of Truthï¼‰ |
| `seed.sql` | åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ–ãƒ­ãƒƒã‚¯å®šç¾©ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç­‰ï¼‰ |

**ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ‰‹é †:**

1. `backend/schema/schema.sql` ã‚’ç·¨é›†
2. `make db-reset` ã§DBã‚’å†æ§‹ç¯‰
3. å‹•ä½œç¢ºèª
4. `docs/DATABASE.md` ã‚’æ›´æ–°

**Makeã‚³ãƒãƒ³ãƒ‰:**

```bash
make db-apply   # ã‚¹ã‚­ãƒ¼ãƒé©ç”¨
make db-seed    # åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥
make db-reset   # DBãƒªã‚»ãƒƒãƒˆï¼ˆdropâ†’applyâ†’seedï¼‰
make db-export  # ç¾åœ¨ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

## Implementation Status

All phases complete (Phase 1-8):
- Workflow CRUD, Steps, Edges
- DAG execution engine (conditions, map, join)
- Adapters (Mock, OpenAI, Anthropic, HTTP)
- Schedules, Webhooks
- Keycloak OIDC auth
- OpenTelemetry tracing
- E2E tests
- K8s deployment manifests
