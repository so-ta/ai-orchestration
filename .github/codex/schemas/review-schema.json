{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["summary", "good_points", "pr_findings", "other_findings", "verdict", "verdict_reason"],
  "additionalProperties": false,
  "properties": {
    "summary": {
      "type": "string",
      "description": "変更内容の要約（2-3文）"
    },
    "good_points": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "良い変更点のリスト"
    },
    "pr_findings": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["file", "title", "body", "severity", "start_line", "end_line", "category", "suggested_code"],
        "additionalProperties": false,
        "properties": {
          "file": {
            "type": "string",
            "description": "ファイルパス"
          },
          "start_line": {
            "type": ["integer", "null"],
            "description": "開始行番号（不明な場合はnull）"
          },
          "end_line": {
            "type": ["integer", "null"],
            "description": "終了行番号（不明な場合はnull）"
          },
          "title": {
            "type": "string",
            "description": "問題のタイトル（日本語）"
          },
          "body": {
            "type": "string",
            "description": "詳細説明（日本語）"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "重要度"
          },
          "category": {
            "type": "string",
            "enum": ["security", "performance", "quality", "test", "documentation"],
            "description": "カテゴリ"
          },
          "suggested_code": {
            "type": ["string", "null"],
            "description": "修正後のコード（suggestion用、なければnull）"
          }
        }
      },
      "description": "PR差分に関する指摘事項のリスト"
    },
    "other_findings": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["file", "title", "body", "severity", "start_line", "end_line", "category", "suggested_code"],
        "additionalProperties": false,
        "properties": {
          "file": {
            "type": "string",
            "description": "ファイルパス"
          },
          "start_line": {
            "type": ["integer", "null"],
            "description": "開始行番号（不明な場合はnull）"
          },
          "end_line": {
            "type": ["integer", "null"],
            "description": "終了行番号（不明な場合はnull）"
          },
          "title": {
            "type": "string",
            "description": "問題のタイトル（日本語）"
          },
          "body": {
            "type": "string",
            "description": "詳細説明（日本語）"
          },
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "重要度"
          },
          "category": {
            "type": "string",
            "enum": ["security", "performance", "quality", "test", "documentation"],
            "description": "カテゴリ"
          },
          "suggested_code": {
            "type": ["string", "null"],
            "description": "修正後のコード（suggestion用、なければnull）"
          }
        }
      },
      "description": "PR差分外で発見した課題のリスト（Issue化される）"
    },
    "verdict": {
      "type": "string",
      "enum": ["APPROVE", "REQUEST_CHANGES", "COMMENT"],
      "description": "最終判定（pr_findingsのみに基づく）"
    },
    "verdict_reason": {
      "type": "string",
      "description": "判定理由（日本語）"
    }
  }
}
